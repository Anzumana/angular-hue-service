/*! angular-hue-service 23-12-2014 */
"use strict";angular.module("hue",[]).service("hue",["$http","$q",function(a,b){var c,d,e,f,g,h,i,j,k,l;c={username:"",debug:!1,apiUrl:"",bridgeIP:""},e=!1,l=function(){var a;return a=b.defer(),e?a.resolve():""===c.apiUrl?d().then(function(b){return c.bridgeIP=b[0].internalipaddress,c.apiUrl="http://"+c.bridgeIP+"/api/"+c.username,e=!0,a.resolve()}):(e=!0,a.resolve()),a.promise},j=function(d,e,f){var g;return g=b.defer(),a.put(e,f).success(function(a){return k(d,a,g)}).error(function(a){return c.debug&&console.log("Error: "+d,a),g.reject}),g.promise},i=function(d,e,f){var g;return g=b.defer(),a.post(e,f).success(function(a){return k(d,a,g)}).error(function(a){return c.debug&&console.log("Error: "+d,a),g.reject}),g.promise},g=function(d,e){var f;return f=b.defer(),a["delete"](e).success(function(a){return k(d,a,f)}).error(function(a){return c.debug&&console.log("Error: "+d,a),f.reject}),f.promise},h=function(d,e){var f;return f=b.defer(),a.get(e).success(function(a){return k(d,a,f)}).error(function(a){return c.debug&&console.log("Error: "+d,a),f.reject}),f.promise},k=function(a,b,d){return null!=b[0]&&b[0].error?(c.debug&&console.log("Error: "+a,b),d.reject):(c.debug&&console.log("Debug: "+a,b),d.resolve(b))},f=function(a){var b,d,e,f;for(null==a&&(a=[]),d=c.apiUrl,e=0,f=a.length;f>e;e++)b=a[e],d+="/"+b;return d},d=function(){return h("getBridgeNupnp","https://www.meethue.com/api/nupnp")},this.getBridgeIP=function(){return l().then(function(){return c.bridgeIP})},this.setup=function(a){return null==a&&(a={}),angular.extend(c,a)},this.getLights=function(){return l().then(function(){return h("getLights",""+c.apiUrl+"/lights")})},this.getNewLights=function(){return l().then(function(){return h("getNewLights",""+c.apiUrl+"/lights/new")})},this.searchNewLights=function(){return l().then(function(){return i("searchNewLights",""+c.apiUrl+"/lights",{})})},this.getLight=function(a){return l().then(function(){return h("getLight",""+c.apiUrl+"/lights/"+a)})},this.setLightName=function(a,b){return l().then(function(){var d;return d={name:b},j("setLightName",""+c.apiUrl+"/lights/"+a,d)})},this.setLightState=function(a,b){return l().then(function(){return j("setLightState",""+c.apiUrl+"/lights/"+a+"/state",b)})},this.getConfiguration=function(){return l().then(function(){return h("getConfiguration",""+c.apiUrl+"/config")})},this.setConfiguration=function(a){return l().then(function(){return j("setConfiguration",""+c.apiUrl+"/config",a)})},this.createUser=function(a,b){return null==b&&(b=!1),l().then(function(){var d;return d={devicetype:a},b&&(d.username=b),i("createUser","http://"+c.bridgeIP+"/api",d)})},this.deleteUser=function(a){return l().then(function(){return g("deleteUser",""+c.apiUrl+"/config/whitelist/"+a)})},this.getFullState=function(){return l().then(function(){return h("getFullState",c.apiUrl)})},this.getGroups=function(){return l().then(function(){return h("getGroups",""+c.apiUrl+"/groups")})},this.createGroup=function(a,b){return l().then(function(){var d;return d={lights:b,name:a},c.debug&&console.log("Debug: createGroup body",d),i("createGroup",""+c.apiUrl+"/groups",d)})},this.getGroupAttributes=function(a){return l().then(function(){return h("getGroupAttributes",""+c.apiUrl+"/groups/"+a)})},this.setGroupAttributes=function(a,b,d){return l().then(function(){var e;return e={lights:d,name:b},j("setGroupAttributes",""+c.apiUrl+"/groups/"+a,e)})},this.setGroupState=function(a,b){return l().then(function(){return j("setGroupState",""+c.apiUrl+"/groups/"+a+"/action",b)})},this.deleteGroup=function(a){return l().then(function(){return g("deleteUser",""+c.apiUrl+"/groups/"+a)})},this.getRules=function(){return l().then(function(){return h("getRules",""+c.apiUrl+"/rules")})},this.getRule=function(a){return l().then(function(){return h("getRule",""+c.apiUrl+"/rules/"+a)})},this.createRule=function(a,b,d){return l().then(function(){var e;return e={name:a,conditions:b,actions:d},i("createRule",""+c.apiUrl+"/rules",e)})},this.updateRule=function(a,b,d,e){return null==b&&(b=!1),null==d&&(d=!1),null==e&&(e=!1),l().then(function(){var a;return a={},b&&(a.name=b),d&&(a.conditions=d),e&&(a.actions=e),c.debug&&console.log("Debug: updateRule body",a),j("updateRule",""+c.apiUrl+"/rules",a)})},this.deleteRule=function(a){return l().then(function(){return g("deleteRule",""+c.apiUrl+"/rules/"+a)})},this.getSchedules=function(){return l().then(function(){return h("getSchedules",""+c.apiUrl+"/schedules")})},this.createSchedule=function(a,b,d,e,f,g){return null==a&&(a="schedule"),null==b&&(b=""),null==f&&(f="enabled"),null==g&&(g=!1),l().then(function(){var h;return h={name:a,description:b,command:d,time:e,status:f,autodelete:g},i("createSchedule",""+c.apiUrl+"/schedules",h)})},this.getScheduleAttributes=function(a){return l().then(function(){return h("getScheduleAttributes",""+c.apiUrl+"/schedules/"+a)})},this.setScheduleAttributes=function(a,b,d,e,f,g,h){return null==b&&(b=null),null==d&&(d=null),null==e&&(e=null),null==f&&(f=null),null==g&&(g=null),null==h&&(h=null),l().then(function(){var f;return f={},b&&(f.name=b),d&&(f.description=d),e&&(f.command=e),g&&(f.status=g),null!==h&&(f.autodelete=h),j("setScheduleAttributes",""+c.apiUrl+"/schedules/"+a,f)})},this.deleteSchedule=function(a){return l().then(function(){return g("deleteSchedule",""+c.apiUrl+"/schedules/"+a)})},this.getScenes=function(){return l().then(function(){return h("getScenes",""+c.apiUrl+"/scenes")})},this.createScene=function(a,b,d){return l().then(function(){var e;return e={name:b,lights:d},j("createScene",""+c.apiUrl+"/scenes/"+a,e)})},this.updateScene=function(a,b,d){return l().then(function(){return j("updateScene",""+c.apiUrl+"/scenes/"+a+"/lights/"+b+"/state",d)})},this.getSensors=function(){return l().then(function(){return h("getSensors",""+c.apiUrl+"/sensors")})},this.createSensor=function(a,b,c,d,e,f,g,h){return null==g&&(g=null),null==h&&(h=null),l().then(function(){var j;return j={name:a,modelid:b,swversion:c,type:d,uniqueid:e,manufacturername:f},g&&(j.state=g),h&&(j.config=h),i("createSensor",""+h.apiUrl+"/sensors",j)})},this.searchNewSensors=function(){return l().then(function(){return i("searchNewSensors",""+c.apiUrl+"/sensors",null)})},this.getNewSensors=function(){return l().then(function(){return h("getNewSensors",""+c.apiUrl+"/sensors/new")})},this.getSensor=function(a){return l().then(function(){return h("getSensor",""+c.apiUrl+"/sensors/"+a)})},this.renameSensor=function(a,b){return l().then(function(){var d;return d={name:b},j("renameSensor",""+c.apiUrl+"/sensors/"+a,d)})},this.updateSensor=function(a,b){return l().then(function(){return j("updateSensor",""+b.apiUrl+"/sensors/"+a+"/config",b)})},this.setSensorState=function(a,b){return l().then(function(){return j("setSensorState",""+c.apiUrl+"/sensors/"+a+"/state",b)})},this.getTimezones=function(){return l().then(function(){return h("getTimezones",""+c.apiUrl+"/info/timezones")})}}]);