/*! angular-hue-service 23-12-2014 */
"use strict";angular.module("hue",[]).service("hue",["$http","$q","$log",function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;d={username:"",apiUrl:"",bridgeIP:""},f=!1,n=function(){var a;return a=b.defer(),f?a.resolve():""===d.apiUrl?e().then(function(b){return null!=b[0]?(d.bridgeIP=b[0].internalipaddress,d.apiUrl="http://"+d.bridgeIP+"/api/"+d.username,f=!0,a.resolve()):(c.error("Error in setup: Returned data from nupnp is empty. Is there a hue bridge present in this network?"),a.reject)},function(b){return c.error("Error in setup: "+b),a.reject}):(f=!0,a.resolve()),a.promise},l=function(d,e,f){var g;return g=b.defer(),a.put(e,f).success(function(a){return m(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},k=function(d,e,f){var g;return g=b.defer(),a.post(e,f).success(function(a){return m(d,a,g)}).error(function(a){return c.error("Error: "+d,a),g.reject}),g.promise},i=function(d,e){var f;return f=b.defer(),a["delete"](e).success(function(a){return m(d,a,f)}).error(function(a){return c.error("Error: "+d,a),f.reject}),f.promise},j=function(d,e){var f;return f=b.defer(),a.get(e).success(function(a){return m(d,a,f)}).error(function(a){return c.error(""+d,a),f.reject}),f.promise},m=function(a,b,d){return null!=b[0]&&b[0].error?(c.error(""+a,b),d.reject):(c.debug("Response of "+a+":",b),d.resolve(b))},h=function(a){var b,c,e,f;for(null==a&&(a=[]),c=d.apiUrl,e=0,f=a.length;f>e;e++)b=a[e],c+="/"+b;return c},g=function(a,b,d){var e,f;switch(null==b&&(b=[]),null==d&&(d=null),e=a+b.join("/"),f=h(b),a){case"get":return j(e,f);case"post":return k(e,f,d);case"put":return l(e,f,d);case"delete":return i(e,f);default:return c.error("unsupported method "+a)}},e=function(){return j("getBridgeNupnp","https://www.meethue.com/api/nupnp")},this.getBridgeIP=function(){return n().then(function(){return d.bridgeIP})},this.setup=function(a){return null==a&&(a={}),angular.extend(d,a)},this.getLights=function(){return n().then(function(){return g("get",["lights"])})},this.getNewLights=function(){return n().then(function(){return g("get",["lights","new"])})},this.searchNewLights=function(){return n().then(function(){return g("post",["lights"],{})})},this.getLight=function(a){return n().then(function(){return g("get",["lights",a])})},this.setLightName=function(a,b){return n().then(function(){return g("put",["lights",a],{name:b})})},this.setLightState=function(a,b){return n().then(function(){return g("put",["lights",a,"state"],b)})},this.getConfiguration=function(){return n().then(function(){return g("get",["config"])})},this.setConfiguration=function(a){return n().then(function(){return g("put",["config"],a)})},this.createUser=function(a,b){return null==b&&(b=!1),n().then(function(){var c;return c={devicetype:a},b&&(c.username=b),g("post",["api"],c)})},this.deleteUser=function(a){return n().then(function(){return g("delete",["config","whitelist",a])})},this.getFullState=function(){return n().then(function(){return g("get")})},this.getGroups=function(){return n().then(function(){return g("get",["groups"])})},this.createGroup=function(a,b){return n().then(function(){var d;return d={lights:b,name:a},c.debug("Debug: createGroup body",d),g("post",["groups"],d)})},this.getGroupAttributes=function(a){return n().then(function(){return g("get",["groups",a])})},this.setGroupAttributes=function(a,b,c){return n().then(function(){var d;return d={lights:c,name:b},g("put",["groups",a],d)})},this.setGroupState=function(a,b){return n().then(function(){return g("put",["groups",a,"action"],b)})},this.deleteGroup=function(a){return n().then(function(){return g("delete",["groups",a])})},this.getRules=function(){return n().then(function(){return g("get",["rules"])})},this.getRule=function(a){return n().then(function(){return g("get",["rules",a])})},this.createRule=function(a,b,c){return n().then(function(){var d;return d={name:a,conditions:b,actions:c},g("post",["rules"],d)})},this.updateRule=function(a,b,d,e){return null==b&&(b=!1),null==d&&(d=!1),null==e&&(e=!1),n().then(function(){var a;return a={},b&&(a.name=b),d&&(a.conditions=d),e&&(a.actions=e),c.debug("Debug: updateRule body",a),g("put",["rules"],a)})},this.deleteRule=function(a){return n().then(function(){return g("delete",["rules",a])})},this.getSchedules=function(){return n().then(function(){return g("get",["schedules"])})},this.createSchedule=function(a,b,c,d,e,f){return null==a&&(a="schedule"),null==b&&(b=""),null==e&&(e="enabled"),null==f&&(f=!1),n().then(function(){var h;return h={name:a,description:b,command:c,time:d,status:e,autodelete:f},g("post",["schedules"],h)})},this.getScheduleAttributes=function(a){return n().then(function(){return g("get",["schedules",a])})},this.setScheduleAttributes=function(a,b,c,d,e,f,h){return null==b&&(b=null),null==c&&(c=null),null==d&&(d=null),null==e&&(e=null),null==f&&(f=null),null==h&&(h=null),n().then(function(){var e;return e={},b&&(e.name=b),c&&(e.description=c),d&&(e.command=d),f&&(e.status=f),null!==h&&(e.autodelete=h),g("put",["schedules",a],e)})},this.deleteSchedule=function(a){return n().then(function(){return g("delete",["schedules",a])})},this.getScenes=function(){return n().then(function(){return g("get",["scenes"])})},this.createScene=function(a,b,c){return n().then(function(){var d;return d={name:b,lights:c},g("put",["scenes",a],d)})},this.updateScene=function(a,b,c){return n().then(function(){return g("put",["scenes",a,"lights",b,"state"],c)})},this.getSensors=function(){return n().then(function(){return g("get",["sensors"])})},this.createSensor=function(a,b,c,d,e,f,h,i){return null==h&&(h=null),null==i&&(i=null),n().then(function(){var j;return j={name:a,modelid:b,swversion:c,type:d,uniqueid:e,manufacturername:f},h&&(j.state=h),i&&(j.config=i),g("post",["sensors"],j)})},this.searchNewSensors=function(){return n().then(function(){return g("post",["sensors"],null)})},this.getNewSensors=function(){return n().then(function(){return g("get",["sensors","new"])})},this.getSensor=function(a){return n().then(function(){return g("get",["sensors",a])})},this.renameSensor=function(a,b){return n().then(function(){var c;return c={name:b},g("put",["sensors",a],c)})},this.updateSensor=function(a,b){return n().then(function(){return g("put",["sensors",a,"config"],b)})},this.setSensorState=function(a,b){return n().then(function(){return g("put",["sensors",a,"state"],b)})},this.getTimezones=function(){return n().then(function(){return g("get",["info","timezones"])})}}]);